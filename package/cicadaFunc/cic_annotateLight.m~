function ACT = cic_annotateLight(ACT, params)
% ---------------------------------------------------------
% Initialize variables and save the thresholds to the stucture
ACT.analysis.settings.lightMetric = params.metric;       % string
ACT.analysis.settings.lightDim    = params.threshold(1); % lux
ACT.analysis.settings.lightBright = params.threshold(2); % lux
% ---------------------------------------------------------
% First, create a new time series for the epoched data
step  = 1/(24*60*60/ACT.epoch);
times = ACT.xmin:step:ACT.xmax;
% ---------------------------------------------------------
% Create a timeseries in 'ACT.analysis.annotate.light'
ACT.analysis.annotate.light = timeseries(zeros(length(times),1), times, 'Name', 'annotateLight');
ACT.analysis.annotate.light.DataInfo.Units = 'a.u.';
ACT.analysis.annotate.light.TimeInfo.Units = 'days';
ACT.analysis.annotate.light.TimeInfo.Format = 'dd-mmm-yyyy HH:MM:SS';
ACT.analysis.annotate.light.TimeInfo.StartDate = '00-Jan-0000 00:00:00';
% ---------------------------------------------------------
% Find the indices
idxMod = ...
    app.ACT.metric.light.(params.metric) >= params.threshold(1) && ...
    app.ACT.metric.light.(params.metric) < params.threshold(2);
idxBright = app.ACT.metric.light.(params.metric) >= params.threshold(2);
% ---------------------------------------------------------
% Set the annotation
ACT.analysis.annotate.light.Data(idxMod) = 1;
ACT.analysis.annotate.light.Data(idxBright) = 2;
% ---------------------------------------------------------
% Set saved to false
ACT.saved = false;
% ---------------------------------------------------------
% Update the pipeline
ACT = cic_updatePipe(ACT, 'analysis');
% ---------------------------------------------------------
% Write history
ACT.history = char(ACT.history, '% ---------------------------------------------------------');
ACT.history = char(ACT.history, '% Annotate the light data');
ACT.history = char(ACT.history, '% -----');
ACT.history = char(ACT.history, '% Define the parameters');
ACT.history = char(ACT.history, sprintf('params.metric = %s; %% name of the metric', params.metric));
ACT.history = char(ACT.history, sprintf('params.threshold = [%i, %i]; %% degrees', params.thrInact_angle));
ACT.history = char(ACT.history, sprintf('params.thrAct_time = %i; %% minutes', params.thrAct_time));
ACT.history = char(ACT.history, sprintf('params.thrAct_lig = %.4f; %% g', params.thrAct_lig));
ACT.history = char(ACT.history, sprintf('params.thrAct_mod = %.4f; %% g', params.thrAct_mod));
ACT.history = char(ACT.history, sprintf('params.thrAct_vig = %.4f; %% g', params.thrAct_vig));
ACT.history = char(ACT.history, sprintf('params.boutCrit = %i; %% percentage', params.boutCrit));
ACT.history = char(ACT.history, sprintf('params.boutClosed = %i; %% logical', params.boutClosed));
ACT.history = char(ACT.history, sprintf('params.boutMetric = %i; %% integer [1 to 4]', params.boutMetric));
ACT.history = char(ACT.history, '% -----');
ACT.history = char(ACT.history, '% Call the annotation function');
ACT.history = char(ACT.history, 'ACT = cic_annotateActivityGGIR(ACT, params);');

end % EOF
